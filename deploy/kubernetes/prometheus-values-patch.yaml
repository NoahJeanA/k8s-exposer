apiVersion: v1
kind: ConfigMap
metadata:
  name: prometheus-stack-grafana-config
  namespace: monitoring
  annotations:
    note: "Apply these values when upgrading kube-prometheus-stack Helm chart"
data:
  grafana-values.yaml: |
    # Grafana configuration for k8s-monitoring
    # Apply with: helm upgrade kube-prometheus-stack prometheus-community/kube-prometheus-stack --values grafana-values.yaml
    
    grafana:
      # Enable anonymous access for sidecar on localhost
      grafana.ini:
        auth.anonymous:
          enabled: true
          org_role: Admin
          org_name: Main Org.
        auth.basic:
          enabled: true
      
      # Sidecar configuration for automatic dashboard loading
      sidecar:
        dashboards:
          enabled: true
          label: grafana_dashboard
          labelValue: "1"
          folder: /tmp/dashboards
          provider:
            foldersFromFilesStructure: false
          # Enable service account token for API calls
          enableUniqueFilenames: false
